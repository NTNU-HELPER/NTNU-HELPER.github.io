<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§å…¬è»Šè·¯ç·šæŸ¥è©¢ (Agent Gradient Mode)</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«”ä»¥ç²å¾—æ›´å¥½çš„ç¾ä»£æ„Ÿ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            /* è±å¯Œçš„æ·±è‰²æ¼¸å±¤èƒŒæ™¯ï¼šæ©™ç´…åˆ°æ·±ç´« (é¡ä¼¼ Zeabur åƒè€ƒåœ–) */
            background: linear-gradient(135deg, #7c2d12 0%, #4c1d95 100%); 
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* è®“å…§å®¹å’Œåº•éƒ¨è¼¸å…¥æ¬„ä½èƒ½æ­£ç¢ºä½ˆå±€ */
            align-items: center;
        }
        /* è‡ªå®šç¾©å…‰æ¨™å‹•ç•« */
        .typing-cursor {
            display: inline-block;
            animation: blink 0.7s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        /* éš±è— textarea çš„é è¨­æ²è»¸ï¼Œç”± autoExpand è™•ç†å…§å®¹ */
        .agent-textarea {
            overflow: hidden;
            height: 48px; /* åˆå§‹é«˜åº¦ï¼Œç¢ºä¿å–®è¡Œé¡¯ç¤º */
            line-height: 24px; /* è¨­å®šè¡Œé«˜ */
        }
    </style>
    <!-- è¼‰å…¥ Firebase æ¨¡çµ„ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: Firebase setup variables (provided by Canvas environment)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        
        // Global Firebase instances
        window.app = null;
        window.db = null;
        window.auth = null;

        // Function to initialize Firebase and authenticate
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.warn("Firebase config is empty. Firestore will not be fully functional.");
                    return;
                }
                
                // Set Firebase log level to debug for better diagnostics
                setLogLevel('debug');

                window.app = initializeApp(firebaseConfig);
                window.db = getFirestore(window.app);
                window.auth = getAuth(window.app);
                
                // Handle authentication
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token.length > 0) {
                    await signInWithCustomToken(window.auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    await signInAnonymously(window.auth);
                    console.log("Signed in anonymously.");
                }

                // Listen for auth state changes
                onAuthStateChanged(window.auth, (user) => {
                    const userIdElement = document.getElementById('user-id-display');
                    if (user) {
                        console.log("User authenticated:", user.uid);
                        userIdElement.textContent = `ä½¿ç”¨è€… ID: ${user.uid}`;
                    } else {
                        console.log("No user is signed in.");
                        userIdElement.textContent = `ä½¿ç”¨è€… ID: N/A (å·²åŒ¿åç™»å…¥)`;
                    }
                });
                
            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }
        }

        window.onload = () => {
            // Start Firebase initialization on load
            initializeFirebase();
            // Start the typing animation
            window.startTypingAnimation(); 
        };
    </script>
</head>
<body class="p-4 md:p-8">

    <!-- ä¸»å…§å®¹å€å¡Š (ç½®ä¸­) -->
    <div class="flex-grow flex flex-col items-center justify-center pt-16 pb-32">
        
        <!-- æ¨™é¡Œå’Œè³‡è¨Š -->
        <header class="text-center mb-16">
            <!-- æ¨™é¡Œæ–‡å­—æ”¹ç‚ºè¶…å¤§ã€é«˜å°æ¯”ç™½è‰² -->
            <h1 class="text-5xl md:text-6xl font-extrabold text-white tracking-tight leading-tight mb-4 drop-shadow-lg">
                ä½ çš„ AI å…¬è»Šè·¯ç·šè¦åŠƒå¸«
            </h1>
            <p class="text-lg text-gray-300 mb-6">é€éè‡ªç„¶èªè¨€å°è©±ï¼Œå–å¾—æœ€ä½³ä¹˜è»Šå»ºè­°ã€‚</p>
            <p id="user-id-display" class="text-sm text-gray-400 mt-2 p-1 px-3 bg-white/10 rounded-full inline-block">ä½¿ç”¨è€… ID: è¼‰å…¥ä¸­...</p>
        </header>

        <!-- å°å¼•è¼¸å…¥å€å¡Š (Typing Animation Prompt) - æ¨¡æ“¬ Agent ä»‹é¢ä¸­çš„æç¤º -->
        <div class="w-full max-w-lg">
            <h2 class="text-lg font-semibold text-teal-300 mb-3 text-center">ğŸ’¡ Agent æç¤ºï¼š</h2>

            <!-- æ¨¡æ“¬æ‰“å­—å‹•ç•«çš„æç¤ºèªå¥ - èƒŒæ™¯ç‚ºåŠé€æ˜çš„æ·±è‰²å¡ç‰‡ -->
            <div class="relative p-6 bg-black/30 border border-purple-500 rounded-xl shadow-2xl transition-all duration-300">
                <p class="text-sm font-medium text-teal-300 mb-2">ç¤ºç¯„èªå¥ï¼š</p>
                <div id="typing-output" class="min-h-[2.5rem] text-xl text-gray-100 font-mono whitespace-pre-wrap">
                    <!-- Typing animation goes here -->
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¦éš› Agent å–®ä¸€è¼¸å…¥å€å¡Š (å›ºå®šåœ¨åº•éƒ¨ï¼Œæ¨¡ä»¿èŠå¤©æ©Ÿå™¨äºº) -->
    <div class="fixed bottom-0 left-0 right-0 p-4 md:p-8 flex justify-center z-40">
        <div class="w-full max-w-3xl bg-gray-900/90 backdrop-blur-sm rounded-2xl p-2 flex items-end shadow-2xl shadow-black/50 border border-purple-700">
            
            <!-- Avatar/Icon (åƒè€ƒ Zeabur åœ–ç‰‡) -->
            <div class="flex-shrink-0 p-3 self-start">
                <img src="https://placehold.co/32x32/14b8a6/FFFFFF/png?text=AI" onerror="this.onerror=null;this.src='https://placehold.co/32x32/14b8a6/FFFFFF/png?text=AI'" alt="AI Agent Icon" class="rounded-full">
            </div>

            <!-- Input Textarea -->
            <textarea 
                id="agent-input" 
                rows="1" 
                placeholder="è©¢å•å…¬è»Šè·¯ç·šï¼Œä¾‹å¦‚ï¼šæˆ‘æƒ³å¾æ°¸è±è·¯å£åå…¬è»Šåˆ°å¸«å¤§" 
                class="agent-textarea flex-grow p-2 bg-transparent text-gray-200 placeholder-gray-500 resize-none focus:outline-none focus:ring-0 text-base"
                oninput="autoExpand(this)"
                onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); simulateSearch(); }"
            ></textarea>
            
            <!-- Send Button -->
            <button onclick="simulateSearch()" class="flex-shrink-0 bg-purple-600 text-white font-semibold py-2 px-6 rounded-xl hover:bg-purple-700 transition duration-200 shadow-md ml-2 disabled:opacity-50" id="send-button">
                é€å‡º
            </button>
        </div>
    </div>

    <!-- JavaScript for Typing Animation and Search Logic -->
    <script>
        const targetText = 'æˆ‘æƒ³å¾æ°¸è±è·¯å£åå…¬è»Šåˆ°å¸«å¤§'; // æç¤ºæ–‡å­—
        const typingSpeed = 100; // æ¯å€‹å­—å…ƒçš„æ¯«ç§’å»¶é²
        let charIndex = 0;
        let typingInterval;
        const outputElement = document.getElementById('typing-output');

        // Helper function for custom non-alert message box (Updated for Dark Mode)
        function showMessage(title, message) {
            const container = document.createElement('div');
            container.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50';
            container.innerHTML = `
                <div class="bg-gray-800 text-white p-6 rounded-xl shadow-2xl max-w-sm w-full border border-teal-600">
                    <h3 class="text-xl font-bold mb-3 text-teal-400">${title}</h3>
                    <p class="text-gray-300 mb-4">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">
                        ç¢ºå®š
                    </button>
                </div>
            `;
            document.body.appendChild(container);
        }

        // Auto-expand textarea function for a cleaner chat-style input
        function autoExpand(textarea) {
            textarea.style.height = 'auto'; // Reset height to recalculate
            textarea.style.height = (textarea.scrollHeight) + 'px'; // Set new height
        }

        // The typing function
        function typeCharacter() {
            if (charIndex < targetText.length) {
                outputElement.textContent += targetText.charAt(charIndex);
                charIndex++;
                // Append the blinking cursor after the current text
                outputElement.innerHTML += '<span class="typing-cursor text-teal-400">|</span>'; 
                // Remove the old cursor before the next character is added
                const cursor = outputElement.querySelector('.typing-cursor');
                if (cursor && charIndex < targetText.length) {
                    cursor.remove();
                }
            } else {
                clearInterval(typingInterval);
                // Keep the final cursor blinking
                outputElement.innerHTML += '<span class="typing-cursor text-teal-400">|</span>'; 
            }
        }

        window.startTypingAnimation = function() {
            // Reset state
            charIndex = 0;
            outputElement.textContent = '';
            
            // Start the interval
            typingInterval = setInterval(typeCharacter, typingSpeed);
        };

        function simulateSearch() {
            const inputField = document.getElementById('agent-input');
            const query = inputField.value.trim();

            if (query === '') {
                showMessage('æç¤º', 'è«‹è¼¸å…¥æ‚¨çš„è‡ªç„¶èªè¨€æŸ¥è©¢ï¼Œä¾‹å¦‚ï¼šã€Œæˆ‘æƒ³å¾æ°¸è±è·¯å£åå…¬è»Šåˆ°å¸«å¤§ã€');
                return;
            }

            const message = `å·²æ¥æ”¶æ‚¨çš„è‡ªç„¶èªè¨€æŸ¥è©¢ï¼š<br><br>ã€Œ<b>${query}</b>ã€ã€‚<br><br>æ¨¡æ“¬ Agent æ­£åœ¨è§£æèµ·é»ã€çµ‚é»å’Œäº¤é€šæ–¹å¼...`;
            showMessage('Agent æ­£åœ¨è™•ç†...', message);
            
            // Clear input after search
            inputField.value = '';
            autoExpand(inputField); // Reset height
        }
    </script>
</body>
</html>
